

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>soa.optimisation &mdash; soa 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> soa
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../License.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Citing.html">Citing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">soa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>soa.optimisation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for soa.optimisation</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pyvisa</span> <span class="k">as</span> <span class="nn">visa</span>

<span class="c1"># make modules importable from anywhere</span>
<span class="c1"># sys.path.append(r&#39;C:\Users\Christopher\OneDrive - University College London\ipes_cdt\phd_project\projects\soa_driving\code\soa_driving\optimisation\python\\&#39;)</span>
<span class="kn">from</span> <span class="nn">soa</span> <span class="kn">import</span> <span class="n">devices</span><span class="p">,</span> <span class="n">signalprocessing</span><span class="p">,</span> <span class="n">analyse</span><span class="p">,</span> <span class="n">distort_tf</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>



<div class="viewcode-block" id="PSO"><a class="viewcode-back" href="../../soa.html#soa.optimisation.PSO">[docs]</a><span class="k">class</span> <span class="nc">PSO</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optimises parameters using particle swarm optimisation (PSO) algorithm</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">t</span><span class="p">,</span> 
                 <span class="n">init_OP</span><span class="p">,</span> 
                 <span class="n">n</span><span class="p">,</span> 
                 <span class="n">iter_max</span><span class="p">,</span> 
                 <span class="n">rep_max</span><span class="p">,</span> 
                 <span class="n">init_v_f</span><span class="p">,</span> 
                 <span class="n">max_v_f</span><span class="p">,</span> 
                 <span class="n">w_init</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> 
                 <span class="n">w_final</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">c1</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">c2</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                 <span class="n">adapt_accel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">sect_to_optimise</span><span class="o">=</span><span class="s1">&#39;whole_signal&#39;</span><span class="p">,</span> 
                 <span class="n">areas_to_suppress</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> 
                 <span class="n">off_suppress_f</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
                 <span class="n">on_suppress_f</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> 
                 <span class="n">embed_init_signal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                 <span class="n">path_to_embedded_signal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">directory</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span> 
                 <span class="n">cost_f</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span> 
                 <span class="n">st_importance_factor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">sim_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">awg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">osc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                 <span class="n">awg_res</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> 
                 <span class="n">min_val</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> 
                 <span class="n">max_val</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                 <span class="n">record_extra_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                 <span class="n">linux</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">SP</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise pso parameters</span>

<span class="sd">        Args:</span>
<span class="sd">        - t (list of floats): time array for signals</span>
<span class="sd">        - init_OP (array of floats): start OP from which to begin optimisation</span>
<span class="sd">        - n (int): number of particles</span>
<span class="sd">        - iter_max (int): max number of pso iterations</span>
<span class="sd">        - rep_max (int): number of times to repeat PSO</span>
<span class="sd">        - init_v_f (float): factor by which to multiply initial positions by to </span>
<span class="sd">        get initial velocity for first iteration</span>
<span class="sd">        - max_v_f (float): factor by which to multiply max param values by to get </span>
<span class="sd">        max velocity for each iteration</span>
<span class="sd">        - w_init (float): initial inertial weight value (0 &lt;= w &lt; 1) e.g. 0.9</span>
<span class="sd">        - w_final (float): final intertia weight value e.g. 0.5 (0 &lt;= w &lt; 1)</span>
<span class="sd">        - c1 (float): acceleration constant (0 &lt;= c1 &lt;= 1)</span>
<span class="sd">        - c2 (float): pso acceleration constant (0 &lt;= c2 &lt;= 1)</span>
<span class="sd">        - adapt_accel (boolean): whether want to use adaptive acceleration i.e. </span>
<span class="sd">        adaptively adjust w, c1 and c2</span>
<span class="sd">        - sect_to_optimise (str): specifies which part of signal to optimise </span>
<span class="sd">        (enter as string from list of options. Must be 1 of: &#39;whole_signal&#39;</span>
<span class="sd">        - areas_to_suppress (str): specify which (if any) areas of signal to </span>
<span class="sd">        restrict in terms of what value they particles can take. Must be 1 of: </span>
<span class="sd">        &#39;None&#39;, &#39;start_centre&#39;, &#39;start_centre_end&#39;, &#39;pisic_shape&#39;</span>
<span class="sd">        - off_suppress_f (float): factor by which to multiply initial guess by </span>
<span class="sd">        when in &#39;off&#39; state and add to this to get space constraint</span>
<span class="sd">        - on_suppress_f (float): factor by which to multiply initial guess by when </span>
<span class="sd">        in &#39;on&#39; state to get on constraing for PSO particles</span>
<span class="sd">        - embed_init_signal (boolean): specify whether want to embed the initial </span>
<span class="sd">        signal amongst the initialised particle positions so that don&#39;t ever </span>
<span class="sd">        optimise towards something that&#39;s worse than initial signal</span>
<span class="sd">        - path_to_embedded_signal (str): give full path to where signal .csv file </span>
<span class="sd">        of signal you want to embed is saved. If path_to_embedded_signal = None </span>
<span class="sd">        and embed_init_signal = True, will embed init_OP amongst the initialised </span>
<span class="sd">        particle positions</span>
<span class="sd">        - directory (str): directory in which we&#39;re working (will save files here)</span>
<span class="sd">        - cost_f (str): cost function to use to evaluate performance. Must be 1</span>
<span class="sd">        of: &#39;mSE&#39;, &#39;st&#39;, &#39;mSE+st&#39;, &#39;s_mse+st&#39;, &#39;mse+st+os&#39;, &#39;zlpc&#39;</span>
<span class="sd">        - st_importance_factor (float): factor by which want settling time to be </span>
<span class="sd">        larger/smaller than mean squared error. Only (and must) specify if using </span>
<span class="sd">        s_mse+st cost_f</span>
<span class="sd">        - sim_model (obj): simulation model to use if using simulation. When model </span>
<span class="sd">        is passed a list of inputs, it should be able to simulate list of outputs</span>
<span class="sd">        - awg (obj): arbitrary waveform generator object if using experiment</span>
<span class="sd">        - osc (obj): oscilliscope object if using experiment</span>
<span class="sd">        - awg_res (int): resolution (bits) of awg used to generate signal</span>
<span class="sd">        - min_val (float): min voltage value awg can take</span>
<span class="sd">        - max_val (float): max voltage value awg can take</span>
<span class="sd">        - record_extra_info (boolean) = If want to plot extra info about PSO. </span>
<span class="sd">        - linux (bool): If True, file dirs have forward slash. If false, have backslash</span>
<span class="sd">        - SP (list of floats): target SP PSO should try to achieve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">linux</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slash</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slash</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span> <span class="o">=</span> <span class="n">init_OP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span> <span class="o">=</span> <span class="n">iter_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span> <span class="o">=</span> <span class="n">rep_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_v_f</span> <span class="o">=</span> <span class="n">init_v_f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_v_f</span> <span class="o">=</span> <span class="n">max_v_f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_init</span> <span class="o">=</span> <span class="n">w_init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_final</span> <span class="o">=</span> <span class="n">w_final</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="n">c1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">=</span> <span class="n">c2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adapt_accel</span> <span class="o">=</span> <span class="n">adapt_accel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sect_to_optimise</span> <span class="o">=</span> <span class="n">sect_to_optimise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">areas_to_suppress</span> <span class="o">=</span> <span class="n">areas_to_suppress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span> <span class="o">=</span> <span class="n">off_suppress_f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_suppress_f</span> <span class="o">=</span> <span class="n">on_suppress_f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embed_init_signal</span> <span class="o">=</span> <span class="n">embed_init_signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_embedded_signal</span> <span class="o">=</span> <span class="n">path_to_embedded_signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_f</span> <span class="o">=</span> <span class="n">cost_f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">st_importance_factor</span> <span class="o">=</span> <span class="n">st_importance_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span> <span class="o">=</span> <span class="n">sim_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awg</span> <span class="o">=</span> <span class="n">awg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">osc</span> <span class="o">=</span> <span class="n">osc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awg_res</span> <span class="o">=</span> <span class="n">awg_res</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_val</span> <span class="o">=</span> <span class="n">min_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_val</span> <span class="o">=</span> <span class="n">max_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SP</span> <span class="o">=</span> <span class="n">SP</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">record_extra_info</span> <span class="o">=</span> <span class="n">record_extra_info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sim_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">awg</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> \
           <span class="n">sim_model</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">osc</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> \
           <span class="n">sim_model</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">awg</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">osc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
           <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Must either use simulation or experimental env to perform </span><span class="se">\</span>
<span class="s1">                      pso in. sim_model, awg and osc cannot all be None /not None.&#39;</span>
           <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt_accel</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">w_final</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Must specifiy w_final value if using adaptive accel.&#39;</span><span class="p">)</span>

        <span class="c1"># get init output</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">X0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__find_x_init</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">init_PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getTransferFunctionOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span><span class="p">,</span> 
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">,</span> 
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> 
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getSoaOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> 

        <span class="c1"># init params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getSectionToOptimise</span><span class="p">()</span> <span class="c1"># opt indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span> <span class="c1"># num params to optimise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">))</span> <span class="c1"># num points in signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_iter</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span> <span class="c1"># current pop position array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="c1"># fitness vals of positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_value</span><span class="p">)</span> <span class="c1"># best local fitness vals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_cost_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span><span class="p">)</span> <span class="c1"># index best fitness</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gbest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span> <span class="c1"># global best positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">min_cost_index</span><span class="p">]</span> <span class="c1"># global best val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">awg_step_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_val</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_val</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">awg_res</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SP</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SP</span> <span class="o">=</span> <span class="n">analyse</span><span class="o">.</span><span class="n">ResponseMeasurements</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_PV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">sp</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SP</span> <span class="o">=</span> <span class="n">SP</span>

        <span class="c1"># set particle position and velocity boundaries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span> <span class="c1"># lower bound on particle positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span> <span class="c1"># upper bound on particle positions</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">LB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_LB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span> <span class="c1"># lower bound on particle velocities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_UB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">)</span> <span class="c1"># upper bound on particle velocities</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_UB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_v_f</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_LB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_UB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># initialise particle positions</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed_init_signal</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_embedded_signal</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="c1"># embed init OP at start</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">init_sig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getInitialDrivingSignalGuess</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_embedded_signal</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_sig</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">LB</span><span class="p">[</span><span class="n">g</span><span class="p">])</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__discretiseParticlePosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__suppressAreasOfSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__discretiseParticlePosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__suppressAreasOfSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__discretiseParticlePosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">+</span> \
                    <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">LB</span><span class="p">[</span><span class="n">g</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__discretiseParticlePosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__suppressAreasOfSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__discretiseParticlePosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__suppressAreasOfSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__discretiseParticlePosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span> 

        <span class="c1"># initialise particle velocities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_v_f</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pbest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_gbest_reached</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># for plotting</span>
    
        <span class="c1"># set up dirs and load data if needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span> <span class="o">+</span> <span class="s1">&#39;data&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span> <span class="c1"># path to save data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pso_dir_name</span> <span class="o">=</span> <span class="s2">&quot;n_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_mxvl_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_val</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_mnvl_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_val</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_ivf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_v_f</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_mvf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_v_f</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_irmx_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_rm_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_cstf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cost_f</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s1">&#39;_sif_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st_importance_factor</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_wi_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_init</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_wf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_final</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_c1_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s2">&quot;_c2_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s1">&#39;_aptacl_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adapt_accel</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s1">&#39;_offsf_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s1">&#39;_onsf_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_suppress_f</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="s1">&#39;_emb_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embed_init_signal</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_data</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pso_dir_name</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_data</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;curr_pos.csv&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Programme detected a curr_pos.csv file in pso data directory &#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39;. Continue from the last particle swarm position(s) saved?&#39;</span><span class="p">)</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;y or n: &quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">ans</span> <span class="o">!=</span> <span class="s1">&#39;y&#39;</span> <span class="ow">or</span> <span class="n">ans</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;y or n&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">ans</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Please check your folders in the path &#39;</span> <span class="o">+</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_data</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="s1">&#39;. Please enter the full path of the folder from which you </span><span class="se">\</span>
<span class="s1">                        want to load your saved data. To find the path, open the </span><span class="se">\</span>
<span class="s1">                        folder and right click on any file saved inside it, </span><span class="se">\</span>
<span class="s1">                        click on properties and copy-past the path. This programme </span><span class="se">\</span>
<span class="s1">                        requires you to manually enter this path because you might </span><span class="se">\</span>
<span class="s1">                        have multiple iteration extension folders to choose from </span><span class="se">\</span>
<span class="s1">                        as a starting point.&#39;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter path of folder data is saved</span><span class="se">\</span>
<span class="s1">                     in (NOT path to specific file): &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span>
                <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Entered path not found. Please enter a valid path to </span><span class="se">\</span>
<span class="s1">                        your saved data&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter path of folder data is </span><span class="se">\</span>
<span class="s1">                        saved in (NOT path to specific file): &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">pbest</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">x_value</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">min_cost_index</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">gbest</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost</span><span class="p">,</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">curr_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__loadPsoData</span><span class="p">()</span> 
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># evaluate init particle positions</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initialising PSO...&#39;</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__evaluateParticlePositions</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> 
                                                            <span class="n">curr_iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">curr_iter</span><span class="p">,</span> 
                                                            <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_value</span><span class="p">)</span> <span class="c1"># store local best vals</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">time_all_particles</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time to evaluate &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s2">&quot; particles == time per generation: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_all_particles</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s2">&quot; s | &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_all_particles</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; mins | &quot;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">((</span><span class="n">time_all_particles</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; hrs&quot;</span><span class="p">)</span>
            <span class="n">time_all_generations</span> <span class="o">=</span> <span class="n">time_all_particles</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time to evaluate &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s2">&quot; generations == estimated time to algorithm completion: &quot;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">time_all_generations</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; s | &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_all_generations</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> \
                <span class="o">+</span> <span class="s2">&quot; mins | &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">((</span><span class="n">time_all_generations</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; hrs&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time to complete all &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; PSO repetitions: &quot;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">time_all_generations</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; s | &quot;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">((</span><span class="n">time_all_generations</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span><span class="p">)</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; mins | &quot;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(((</span><span class="n">time_all_generations</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span><span class="o">/</span><span class="mi">60</span><span class="p">))</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; hrs&quot;</span><span class="p">)</span>
            
            <span class="c1"># init global cost history for plotting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost_history</span> <span class="o">=</span> <span class="p">[]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">min_cost_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gbest</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbest</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">min_cost_index</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">min_cost_index</span><span class="p">]</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost_history</span><span class="p">],</span> 
                                                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost</span><span class="p">])</span> 

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Costs: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Best cost: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost</span><span class="p">))</span>

            <span class="c1"># init analysis vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rt_st_os_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__analyseSignal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest</span><span class="p">,</span> <span class="n">curr_iter</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> 

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_extra_info</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># record init particle positions and pbest</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__savePsoData</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> 
                                   <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_value</span><span class="p">),</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">curr_iter</span><span class="p">,</span> 
                                   <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbest</span><span class="p">),</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost_history</span><span class="p">,</span> 
                                   <span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">rt_st_os_analysis</span><span class="p">)</span>


        <span class="c1"># run pso algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__runPsoAlgorithm</span><span class="p">()</span> 

    <span class="k">def</span> <span class="nf">__analyseSignal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">OP</span><span class="p">,</span> <span class="n">curr_iter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method analyses a signal to get its rise time, settling time and </span>
<span class="sd">        overshoot. Will also save input and output data</span>

<span class="sd">        Args:</span>
<span class="sd">        - OP = driving signal whose resultant output we want to analyse</span>
<span class="sd">        - curr_iter = current iteration. Use this for saving.</span>

<span class="sd">        Returns:</span>
<span class="sd">        - [rt, st, os] = table with rise time, settling time and overshoot of </span>
<span class="sd">        output signal</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># GET OUTPUT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getTransferFunctionOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span><span class="p">,</span> 
                                                  <span class="n">OP</span><span class="p">,</span> 
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> 
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getSoaOutput</span><span class="p">(</span><span class="n">OP</span><span class="p">)</span> 

        <span class="n">OP_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">OP</span><span class="p">)</span>
        <span class="n">OP_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;OP_itr&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> 
                     <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">PV_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">PV</span><span class="p">)</span>
        <span class="n">PV_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;PV_itr&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span><span class="p">,</span> 
                     <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">responseMeasurementsObject</span> <span class="o">=</span> <span class="n">analyse</span><span class="o">.</span><span class="n">ResponseMeasurements</span><span class="p">(</span><span class="n">PV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> 

        <span class="n">rt</span> <span class="o">=</span> <span class="n">responseMeasurementsObject</span><span class="o">.</span><span class="n">riseTime</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">responseMeasurementsObject</span><span class="o">.</span><span class="n">settlingTime</span>
        <span class="n">os</span> <span class="o">=</span> <span class="n">responseMeasurementsObject</span><span class="o">.</span><span class="n">overshoot</span>
        <span class="n">st_index</span> <span class="o">=</span> <span class="n">responseMeasurementsObject</span><span class="o">.</span><span class="n">settlingTimeIndex</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">rt</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">st_index</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">__getInitialDrivingSignalGuess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_sig</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method loads a previously defined csv with the driving signal that </span>
<span class="sd">        we want to use as our initial guess to embed amongst the initialised </span>
<span class="sd">        particle positions</span>

<span class="sd">        Args:</span>
<span class="sd">        - path_to_sig = path to signal that want to use </span>

<span class="sd">        Returns:</span>
<span class="sd">        - init_sig = initial guess for signal to embed amongst particles</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">init_sig_array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_sig</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> 
        <span class="n">init_sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">init_sig_array</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_sig_array</span><span class="p">)):</span>
            <span class="n">init_sig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">init_sig_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 

        <span class="k">return</span> <span class="n">init_sig</span>

    <span class="k">def</span> <span class="nf">__savePsoData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                      <span class="n">x</span><span class="p">,</span> 
                      <span class="n">x_value</span><span class="p">,</span> 
                      <span class="n">curr_iter</span><span class="p">,</span> 
                      <span class="n">pbest</span><span class="p">,</span> 
                      <span class="n">gbest_cost_history</span><span class="p">,</span> 
                      <span class="n">iter_gbest_reached</span><span class="p">,</span> 
                      <span class="n">rt_st_os_analysis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is for saving pso progress so it can later be loaded</span>

<span class="sd">        Args:</span>
<span class="sd">        - x = particle positions to save</span>
<span class="sd">        - x_value = fitness values for current positions</span>
<span class="sd">        - pbest = personal historic best position for each particle</span>
<span class="sd">        - curr_iter = current iteration reached so far</span>
<span class="sd">        - gbest_cost_history = history of gbest reached</span>
<span class="sd">        - iter_gbest_reached = corresponding iteration new gbest was found</span>
<span class="sd">        - rt_st_os_analysis = hsitory of rise time, settling time and overshoot</span>
<span class="sd">        throughout pso algoithm</span>

<span class="sd">        Returns:</span>
<span class="sd">        - </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">iter_gbest_reached_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">iter_gbest_reached</span><span class="p">)</span>
        <span class="n">gbest_cost_history_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gbest_cost_history</span><span class="p">)</span>
        <span class="n">rt_st_os_analysis_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rt_st_os_analysis</span><span class="p">)</span>
        <span class="n">curr_pos_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">curr_pos_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;curr_pos.csv&#39;</span><span class="p">,</span> 
                           <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                           <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">curr_pos_val_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x_value</span><span class="p">)</span>
        <span class="n">curr_pos_val_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;curr_pos_values.csv&#39;</span><span class="p">,</span> 
                               <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                               <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">iter_gbest_reached_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;iter_gbest_reached.csv&quot;</span><span class="p">,</span> 
                                     <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">gbest_cost_history_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;gbest_cost_history.csv&quot;</span><span class="p">,</span> 
                                     <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rt_st_os_analysis_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;rt_st_os_analysis.csv&#39;</span><span class="p">,</span> 
                                    <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;curr_iter.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_extra_info</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># save x and pbest for each particle</span>
            <span class="n">curr_pbest_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">curr_pbest_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;curr_inputs_&#39;</span> \
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> 
                                 <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>   
                                 <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">curr_x_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pbest</span><span class="p">)</span>
            <span class="n">curr_x_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;pbest_pos_&#39;</span> \
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> 
                             <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                             <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__loadPsoData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method loads previously saved pso data</span>

<span class="sd">        Args:</span>
<span class="sd">        - </span>

<span class="sd">        Returns:</span>
<span class="sd">        - iter_max = max number of pso iterations</span>
<span class="sd">        - path_to_pso_data = path to where pso data will now be stored</span>
<span class="sd">        - x = particle positions</span>
<span class="sd">        - pbest = local particle position values</span>
<span class="sd">        - x_value = fitness of particle positions</span>
<span class="sd">        - pbest_value = local particle position best fitnesses</span>
<span class="sd">        - min_cost_index = particle index of fittest particle</span>
<span class="sd">        - gbest = global best particle</span>
<span class="sd">        - gbest_cost = global best particle fitness</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># init params</span>
        <span class="n">iter_max</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">curr_iter</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> 
        <span class="n">x_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> 
        <span class="n">min_cost_index</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">gbest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">))</span> 

        <span class="c1"># get where saved data is</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter folder path of data: &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span>
        <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Entered path not found. Enter a valid path to your saved data&#39;</span><span class="p">)</span>
            <span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter folder path of data: &#39;</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span>
        <span class="n">curr_iter_array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;curr_iter.csv&quot;</span><span class="p">,</span> 
                                      <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> 
        <span class="n">curr_iter</span> <span class="o">=</span> <span class="n">curr_iter_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">curr_iter</span> <span class="o">=</span> <span class="n">curr_iter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># update</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;How many more generations would you like to do?&#39;</span><span class="p">)</span>
        <span class="n">extend_iterations_by</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Number of extra generations (integer): &#39;</span><span class="p">))</span>
        <span class="k">while</span> <span class="nb">type</span><span class="p">(</span><span class="n">extend_iterations_by</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">extend_iterations_by</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Number of extra generations (integer): &#39;</span><span class="p">))</span>
        <span class="n">iter_max</span> <span class="o">=</span> <span class="n">curr_iter</span> <span class="o">+</span> <span class="n">extend_iterations_by</span>
        <span class="n">pso_dir_name</span> <span class="o">=</span> <span class="s2">&quot;n_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_mxvl_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_val</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_mnvl_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_val</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_ivf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_v_f</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_mvf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_v_f</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_irmx_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_rm_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_cstf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cost_f</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s1">&#39;_sif_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">st_importance_factor</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_wi_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_init</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_wf_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_final</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_c1_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s2">&quot;_c2_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s1">&#39;_aptacl_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adapt_accel</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s1">&#39;_offsf_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s1">&#39;_onsf_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_suppress_f</span><span class="p">)</span> <span class="o">+</span> \
                       <span class="s1">&#39;_embd_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">embed_init_signal</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span>
        <span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_data</span> <span class="o">+</span> <span class="n">pso_dir_name</span>

        <span class="c1"># load positions</span>
        <span class="n">x_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;curr_pos.csv&quot;</span><span class="p">,</span> 
                           <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
        <span class="n">x_array</span> <span class="o">=</span> <span class="n">x_df</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span><span class="p">):</span>
            <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
        <span class="n">pbest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># load position vals</span>
        <span class="n">x_value_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;curr_pos_values.csv&quot;</span><span class="p">,</span> 
                                 <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> 
        <span class="n">x_value_array</span> <span class="o">=</span> <span class="n">x_value_df</span><span class="o">.</span><span class="n">values</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
            <span class="n">x_value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x_value_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
        <span class="n">pbest_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_value</span><span class="p">)</span>
        <span class="n">min_cost_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">pbest_value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)):</span>
            <span class="n">gbest</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">pbest</span><span class="p">[</span><span class="n">min_cost_index</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> 
        <span class="n">gbest_cost</span> <span class="o">=</span> <span class="n">pbest_value</span><span class="p">[</span><span class="n">min_cost_index</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">iter_max</span><span class="p">,</span> 
                <span class="n">path_to_pso_data</span><span class="p">,</span> 
                <span class="n">x</span><span class="p">,</span> 
                <span class="n">pbest</span><span class="p">,</span> 
                <span class="n">x_value</span><span class="p">,</span> 
                <span class="n">pbest_value</span><span class="p">,</span>
                <span class="n">min_cost_index</span><span class="p">,</span> 
                <span class="n">gbest</span><span class="p">,</span> 
                <span class="n">gbest_cost</span><span class="p">,</span> 
                <span class="n">curr_iter</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data</span>


    <span class="k">def</span> <span class="nf">__find_x_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method calculates the state-vector from a long -1 drive signal. </span>
<span class="sd">        Must call before sending / receiving signals to / from transfer function </span>
<span class="sd">        model</span>

<span class="sd">        Args:</span>
<span class="sd">        - tf = transfer function</span>

<span class="sd">        Returns:</span>
<span class="sd">        - X0 = system&#39;s state-vector result for steady state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">480</span><span class="p">)</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">40e-9</span><span class="p">,</span> <span class="mi">480</span><span class="p">)</span>
        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">xout</span><span class="p">)</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lsim2</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="n">U</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">X0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-13</span><span class="p">)</span>
        <span class="n">X0</span> <span class="o">=</span> <span class="n">xout</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">X0</span>
        

    <span class="k">def</span> <span class="nf">__getTransferFunctionOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">X0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sends a drive signal to a transfer function model and gets </span>
<span class="sd">        the output</span>

<span class="sd">        Args:</span>
<span class="sd">        - tf = transfer function</span>
<span class="sd">        - U = signal to drive transfer function with</span>
<span class="sd">        - T = array of time values</span>
<span class="sd">        - X0 = initial value</span>
<span class="sd">        - atol = scipy ode func parameter</span>

<span class="sd">        Returns:</span>
<span class="sd">        - PV = resultant output signal of transfer function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">PV</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">lsim2</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">X0</span><span class="o">=</span><span class="n">X0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span>

        <span class="c1"># ensure lower point of signal &gt;=0 (can occur for sims), otherwise</span>
        <span class="c1"># will destroy st, os and rt analysis</span>
        <span class="n">min_PV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">PV</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">min_PV</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">PV</span><span class="p">)):</span>
                <span class="n">PV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">PV</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">min_PV</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PV</span>


    <span class="k">def</span> <span class="nf">__getSoaOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">OP</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sends a drive signal to the SOA and gets an soa output</span>

<span class="sd">        Args:</span>
<span class="sd">        - OP = signal to send to AWG which will be used to drive SOA</span>
<span class="sd">        - channel = channel osc reads soa output on</span>

<span class="sd">        Returns:</span>
<span class="sd">        - PV = soa output</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">OP</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="c1"># must convert to float as osc only takes list of floats</span>
            <span class="n">flattened_OP</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">OP</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no need to convert</span>
            <span class="n">flattened_OP</span> <span class="o">=</span> <span class="n">OP</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">awg</span><span class="o">.</span><span class="n">send_waveform</span><span class="p">(</span><span class="n">flattened_OP</span><span class="p">,</span> <span class="n">suppress_messages</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">osc</span><span class="o">.</span><span class="n">measurement</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PV</span>

    <span class="k">def</span> <span class="nf">__getSectionToOptimise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method sets the section of the signal that we want to optimise</span>

<span class="sd">        Args:</span>
<span class="sd">        - </span>

<span class="sd">        Returns:</span>
<span class="sd">        - K_index = column vector of particle indices</span>
<span class="sd">        - K = column vector of particle values</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sect_to_optimise</span> <span class="o">==</span> <span class="s1">&#39;whole_signal&#39;</span><span class="p">:</span>
            <span class="n">start_opt_index</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">end_opt_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_points</span><span class="p">)</span> 
        
        <span class="c1"># create index and value arrays of points (particles K) to optimise</span>
        <span class="n">K_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_opt_index</span><span class="p">,</span> <span class="n">end_opt_index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="n">start_opt_index</span><span class="p">:</span><span class="n">end_opt_index</span><span class="p">]])</span>

        <span class="c1"># transpose to column vectors </span>
        <span class="n">K_index</span> <span class="o">=</span> <span class="n">K_index</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">K_index</span><span class="p">,</span> <span class="n">K</span>

    <span class="k">def</span> <span class="nf">__discretiseParticlePosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method discretises a drive signal/particle positions so that they </span>
<span class="sd">        can be read by awg. This also reduces the size of the pso algorithm</span>
<span class="sd">        search space of particle positions, which will speed up convergence</span>

<span class="sd">        Args:</span>
<span class="sd">        - part_pos = drive signal / particle position</span>

<span class="sd">        Returns: </span>
<span class="sd">        - discretised particle position</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">part_pos</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">part_pos</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">awg_step_size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># value not allowed therefore must discretise</span>
                <span class="n">part_pos</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">part_pos</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">awg_step_size</span><span class="p">)</span> \
                    <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">awg_step_size</span> 
        
        <span class="k">return</span> <span class="n">part_pos</span>

    <span class="k">def</span> <span class="nf">__suppressAreasOfSignal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">part_pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method suppresses (or doesn&#39;t) various areas of the drive signal </span>
<span class="sd">        from being able to take certain values depending on what user has specified</span>

<span class="sd">        Args:</span>
<span class="sd">        - part_pos = drive signal / particle position</span>

<span class="sd">        Returns:</span>
<span class="sd">        - suppressed (or not suppressed) particle position</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas_to_suppress</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="c1"># no suppression</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas_to_suppress</span> <span class="o">==</span> <span class="s1">&#39;start_centre&#39;</span><span class="p">:</span>
            <span class="c1"># get params</span>
            <span class="n">start_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">end_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
            <span class="n">max_drive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start_drive</span><span class="p">:</span>
                    <span class="c1"># get particle index signal turns on</span>
                    <span class="n">K_index_signal_on</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)))</span> 
                    <span class="k">break</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">K_index_signal_on</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">end_drive</span><span class="p">:</span>
                    <span class="c1"># get particle index signal turns off</span>
                    <span class="n">K_index_signal_off</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)))</span> 

            <span class="c1"># suppress start and centre</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">K_index_signal_on</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start_drive</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="o">*</span><span class="n">start_drive</span><span class="p">):</span>
                        <span class="c1"># suppress start of signal</span>
                        <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_drive</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="o">*</span><span class="n">start_drive</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K_index_signal_on</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_drive</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_suppress_f</span><span class="o">*</span><span class="n">max_drive</span><span class="p">):</span>
                    <span class="c1"># suppress centre  to end of signal</span>
                    <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_drive</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_suppress_f</span><span class="o">*</span><span class="n">max_drive</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas_to_suppress</span> <span class="o">==</span> <span class="s1">&#39;start_centre_end&#39;</span><span class="p">:</span>
            <span class="c1"># get params</span>
            <span class="n">start_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">max_drive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start_drive</span><span class="p">:</span>
                    <span class="n">K_index_signal_on</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)))</span> 
                    <span class="k">break</span>

            <span class="c1"># suppress start, centre and end</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">K_index_signal_on</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start_drive</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="o">*</span><span class="n">start_drive</span><span class="p">):</span>
                    <span class="c1"># suppress start of signal</span>
                    <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_drive</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="o">*</span><span class="n">start_drive</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K_index_signal_off</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">))):</span>
                <span class="k">if</span> <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">end_drive</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="o">*</span><span class="n">start_drive</span><span class="p">):</span>
                    <span class="c1"># suppress end of signal</span>
                    <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_drive</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="o">*</span><span class="n">start_drive</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K_index_signal_on</span><span class="p">,</span> <span class="n">K_index_signal_off</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_drive</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_suppress_f</span><span class="o">*</span><span class="n">max_drive</span><span class="p">):</span>
                    <span class="c1"># suppress centre of signal</span>
                    <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_drive</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_suppress_f</span><span class="o">*</span><span class="n">max_drive</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">areas_to_suppress</span> <span class="o">==</span> <span class="s1">&#39;pisic_shape&#39;</span><span class="p">:</span>
            <span class="c1"># suppress start and most of centre except for leading edge of </span>
            <span class="c1"># drive signal, as this is an optional pisic area for PSO to fill</span>
            <span class="n">pisic_length_factor</span> <span class="o">=</span> <span class="mf">0.1</span>

            <span class="c1"># get params</span>
            <span class="n">start_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 
            <span class="n">end_drive</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
            <span class="n">max_drive</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start_drive</span><span class="p">:</span>
                    <span class="n">K_index_signal_on</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)))</span> 
                    <span class="k">break</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">K_index_signal_on</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">end_drive</span><span class="p">:</span>
                    <span class="n">K_index_signal_off</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)))</span>

            <span class="c1"># suppress start and centre</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">K_index_signal_on</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">start_drive</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="o">*</span><span class="n">start_drive</span><span class="p">):</span>
                    <span class="c1"># suppress start of signal</span>
                    <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_drive</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">off_suppress_f</span><span class="o">*</span><span class="n">start_drive</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">K_index_signal_on</span> <span class="o">+</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)</span><span class="o">*</span><span class="n">pisic_length_factor</span><span class="p">)),</span> 
                               <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># suppress centre to below the step/initial input (except </span>
                    <span class="c1"># pisic area, whose length is defined by pisic_length_factor)</span>
                    <span class="n">part_pos</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


        <span class="k">return</span> <span class="n">part_pos</span>

    <span class="k">def</span> <span class="nf">__evaluateParticlePositions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particles</span><span class="p">,</span> <span class="n">curr_iter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method evaluates the positions of each particle in an array</span>

<span class="sd">        Args:</span>
<span class="sd">        - particles = array of particles to evaluate</span>
<span class="sd">        - plot = set whether want to plot (and save) the resultant PV and OP when </span>
<span class="sd">        each particle is used to drive SOA</span>
<span class="sd">        - curr_iter = current iteration pso is on (only needed if plot == True)</span>

<span class="sd">        Returns:</span>
<span class="sd">        - x_value = array of fitness values for each particle position</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_extra_info</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">curr_outputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">))</span> 

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">curr_iter</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;method requires arg curr_iter if want to plot&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="c1"># int current particle fitnesses/costs storage</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span> 
            <span class="n">particle</span> <span class="o">=</span> <span class="n">particles</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> 
            <span class="n">OP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> 
            <span class="n">particleIndex</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">signalIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">K_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">OP</span><span class="p">[</span><span class="n">signalIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">particle</span><span class="p">[</span><span class="n">particleIndex</span><span class="p">]</span>
                <span class="n">particleIndex</span> <span class="o">+=</span> <span class="mi">1</span> 

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getTransferFunctionOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span><span class="p">,</span> 
                                                      <span class="n">OP</span><span class="p">,</span> 
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> 
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getSoaOutput</span><span class="p">(</span><span class="n">OP</span><span class="p">)</span> 

            <span class="n">x_value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">signalprocessing</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> 
                                               <span class="n">PV</span><span class="p">,</span> 
                                               <span class="n">cost_function_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cost_f</span><span class="p">,</span> 
                                               <span class="n">st_importance_factor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">st_importance_factor</span><span class="p">,</span> 
                                               <span class="n">SP</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span><span class="o">.</span><span class="n">costEval</span> 

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_extra_info</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="c1"># store particle output</span>
                <span class="n">curr_outputs</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">PV</span>
            
            <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">PV</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span> 
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">OP</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># get best fitness for analysis</span>
            <span class="n">min_cost_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">x_value</span><span class="p">)</span>       
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">best_PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getTransferFunctionOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span><span class="p">,</span> 
                                                           <span class="n">particles</span><span class="p">[</span><span class="n">min_cost_index</span><span class="p">,:],</span> 
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> 
                                                           <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">best_PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getSoaOutput</span><span class="p">(</span><span class="n">particles</span><span class="p">[</span><span class="n">min_cost_index</span><span class="p">,</span> <span class="p">:])</span>      

        
        <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># finalise and save plot</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Target SP&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_PV</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Initial Output&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">best_PV</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best fitness&#39;</span><span class="p">)</span>
            <span class="n">st_index</span> <span class="o">=</span> <span class="n">analyse</span><span class="o">.</span><span class="n">ResponseMeasurements</span><span class="p">(</span><span class="n">best_PV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">settlingTimeIndex</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">st_index</span><span class="p">],</span> 
                     <span class="n">best_PV</span><span class="p">[</span><span class="n">st_index</span><span class="p">],</span> 
                     <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> 
                     <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> 
                     <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> 
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Settling Point&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PSO-Optimised Output Signals After &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39; Generations&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_gen_outputs.png&#39;</span><span class="p">)</span>  
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> 
                     <span class="n">particles</span><span class="p">[</span><span class="n">min_cost_index</span><span class="p">,</span> <span class="p">:],</span> 
                     <span class="n">c</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> 
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best fitness&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PSO-Optimised Input Signals After &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s1">&#39; Generations&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_gen_inputs.png&#39;</span><span class="p">)</span>  
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_extra_info</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># save current particle outputs</span>
            <span class="n">curr_outputs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">curr_outputs</span><span class="p">)</span>
            <span class="n">curr_outputs_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;curr_outputs_&#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> 
                                   <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                                   <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">x_value</span> 
                
    <span class="k">def</span> <span class="nf">__runPsoAlgorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method runs the pso algorithm</span>

<span class="sd">        Args:</span>
<span class="sd">        - </span>

<span class="sd">        Returns:</span>
<span class="sd">        - </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># INITIALISE COPIES OF PARAMETERS WE&#39;RE CHANGING</span>
        <span class="c1"># v = np.copy(self.v)</span>
        <span class="c1"># x = np.copy(self.x)</span>
        <span class="c1"># x_value = np.copy(self.x_value)</span>
        <span class="c1"># pbest = np.copy(self.pbest)</span>
        <span class="c1"># pbest_value = np.copy(self.pbest_value)</span>
        <span class="c1"># gbest = np.copy(self.gbest)</span>
        <span class="c1"># curr_iter = np.copy(self.curr_iter)</span>
        <span class="c1"># gbest_cost = np.copy(self.gbest_cost)</span>
        <span class="c1"># gbest_cost_history = np.copy(self.gbest_cost_history)</span>
        <span class="c1"># iter_gbest_reached = np.copy(self.iter_gbest_reached)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;################### RUNNING PSO ALGORITHM #####################&#39;</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_value</span><span class="p">)</span>
        <span class="n">pbest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbest</span><span class="p">)</span>
        <span class="n">pbest_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span><span class="p">)</span>
        <span class="n">gbest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest</span><span class="p">)</span>
        <span class="n">curr_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curr_iter</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">gbest_cost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost</span><span class="p">)</span>
        <span class="n">gbest_cost_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest_cost_history</span><span class="p">)</span>
        <span class="n">rt_st_os_analysis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rt_st_os_analysis</span><span class="p">)</span>
        <span class="n">iter_gbest_reached</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_gbest_reached</span><span class="p">)</span>
        <span class="n">meta_path_to_pso_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span>

        <span class="c1"># # run thru pso multiple times</span>
        <span class="n">curr_rep</span> <span class="o">=</span> <span class="mi">1</span> 
        <span class="k">while</span> <span class="n">curr_rep</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;rep&#39;</span> <span class="o">+</span> \
                <span class="nb">str</span><span class="p">(</span><span class="n">curr_rep</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slash</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span><span class="p">)</span> 
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embed_init_signal</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">gbest</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="c1"># embed signal guess</span>

            <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_init</span>
            <span class="n">c1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1</span>
            <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt_accel</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">rel_improv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
                <span class="n">c1_max</span> <span class="o">=</span> <span class="mf">2.5</span> 
                <span class="n">c2_max</span> <span class="o">=</span> <span class="mf">2.5</span> 
                <span class="n">c1_min</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="n">c2_min</span> <span class="o">=</span> <span class="mf">0.1</span>

            <span class="n">pc_marker</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.05</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">)</span> <span class="c1"># for plotting/saving</span>
            <span class="k">if</span> <span class="n">pc_marker</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pc_marker</span> <span class="o">=</span> <span class="mi">1</span> 

            <span class="k">while</span> <span class="n">curr_iter</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt_accel</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                        <span class="c1"># update particle vals</span>
                        <span class="n">rel_improv</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pbest_value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_value</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> \
                            <span class="o">/</span> <span class="p">(</span><span class="n">pbest_value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">x_value</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> 
                        <span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_init</span> <span class="o">+</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_final</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_init</span><span class="p">)</span> <span class="o">*</span> \
                            <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">rel_improv</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">rel_improv</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">)</span> 
                        <span class="n">c1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">c1_min</span> <span class="o">+</span> <span class="n">c1_max</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">c1_max</span> <span class="o">-</span> <span class="n">c1_min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rel_improv</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rel_improv</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> 
                        <span class="n">c2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">c2_min</span> <span class="o">+</span> <span class="n">c2_max</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">c2_max</span> <span class="o">-</span> <span class="n">c2_min</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
                            <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rel_improv</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rel_improv</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> 
                
                <span class="c1"># update particle velocities</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">c1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> \
                            <span class="o">*</span> <span class="p">(</span><span class="n">pbest</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span><span class="n">c2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> \
                                <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">gbest</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">g</span><span class="p">])))</span>

                <span class="c1"># handle velocity boundary violations</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_UB</span><span class="p">[</span><span class="n">g</span><span class="p">]:</span>
                            <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_UB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_LB</span><span class="p">[</span><span class="n">g</span><span class="p">]:</span>
                            <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_LB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
                
                <span class="c1"># update particle positions</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span>
                
                <span class="c1"># handle position boundary violations</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">LB</span><span class="p">[</span><span class="n">g</span><span class="p">]:</span>
                            <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">UB</span><span class="p">[</span><span class="n">g</span><span class="p">]:</span>
                            <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UB</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>

                <span class="c1"># descretise</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__discretiseParticlePosition</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>

                <span class="c1"># suppress</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__suppressAreasOfSignal</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:])</span>

                <span class="c1"># eval particle positions</span>
                <span class="k">if</span> <span class="n">curr_iter</span> <span class="o">%</span> <span class="n">pc_marker</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">curr_iter</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">:</span>
                    <span class="c1"># plot/save</span>
                    <span class="n">x_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__evaluateParticlePositions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> 
                                                               <span class="n">curr_iter</span><span class="o">=</span><span class="n">curr_iter</span><span class="p">,</span> 
                                                               <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__evaluateParticlePositions</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> 
                                                               <span class="n">curr_iter</span><span class="o">=</span><span class="n">curr_iter</span><span class="p">,</span> 
                                                               <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                
                <span class="c1"># update local best particle positions &amp; fitness vals</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">x_value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pbest_value</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">pbest_value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> 
                        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                            <span class="n">pbest</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span> 
                
                <span class="c1"># update global best particle positions &amp; history</span>
                <span class="n">min_cost_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">pbest_value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pbest_value</span><span class="p">[</span><span class="n">min_cost_index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">gbest_cost_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m</span><span class="p">):</span>
                        <span class="n">gbest</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">pbest</span><span class="p">[</span><span class="n">min_cost_index</span><span class="p">,</span> <span class="n">g</span><span class="p">]</span>
                    <span class="n">rt_st_os_analysis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">rt_st_os_analysis</span><span class="p">,</span> 
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">__analyseSignal</span><span class="p">(</span><span class="n">gbest</span><span class="p">,</span> 
                                                                        <span class="n">curr_iter</span><span class="p">)))</span>
                    <span class="n">gbest_cost</span> <span class="o">=</span> <span class="n">pbest_value</span><span class="p">[</span><span class="n">min_cost_index</span><span class="p">]</span>
                    <span class="n">gbest_cost_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">gbest_cost_history</span><span class="p">],</span> <span class="p">[</span><span class="n">gbest_cost</span><span class="p">])</span>
                    <span class="n">iter_gbest_reached</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">iter_gbest_reached</span><span class="p">],</span> <span class="p">[</span><span class="n">curr_iter</span><span class="p">])</span>
                <span class="n">cost_reduction</span> <span class="o">=</span> <span class="p">((</span><span class="n">gbest_cost_history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">gbest_cost</span><span class="p">)</span> \
                    <span class="o">/</span> <span class="n">gbest_cost_history</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span>

                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reduced cost by &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cost_reduction</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">% s</span><span class="s1">o far&#39;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">__savePsoData</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> 
                                   <span class="n">x_value</span><span class="p">,</span> 
                                   <span class="n">curr_iter</span><span class="p">,</span> 
                                   <span class="n">pbest</span><span class="p">,</span> 
                                   <span class="n">gbest_cost_history</span><span class="p">,</span> 
                                   <span class="n">iter_gbest_reached</span><span class="p">,</span> 
                                   <span class="n">rt_st_os_analysis</span><span class="p">)</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num iterations completed: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_iter</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">))</span>
                <span class="n">curr_iter</span> <span class="o">+=</span> <span class="mi">1</span> 

            <span class="c1"># ensure cost and analysis table has final gbest val</span>
            <span class="n">gbest_cost_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">gbest_cost_history</span><span class="p">],</span> <span class="p">[</span><span class="n">gbest_cost</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rt_st_os_analysis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">rt_st_os_analysis</span><span class="p">,</span> 
                                                <span class="bp">self</span><span class="o">.</span><span class="n">__analyseSignal</span><span class="p">(</span><span class="n">gbest</span><span class="p">,</span> 
                                                                     <span class="n">curr_iter</span><span class="p">)))</span>
            <span class="n">iter_gbest_reached</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">iter_gbest_reached</span><span class="p">],</span>   
                                           <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_max</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">__getPsoPerformance</span><span class="p">(</span><span class="n">gbest</span><span class="p">,</span> 
                                     <span class="n">iter_gbest_reached</span><span class="p">,</span> 
                                     <span class="n">gbest_cost_history</span><span class="p">,</span> 
                                     <span class="bp">self</span><span class="o">.</span><span class="n">rt_st_os_analysis</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Num PSO repetitions completed: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">curr_rep</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rep_max</span><span class="p">))</span>
            <span class="c1"># reset for next pso run</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="n">x_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_value</span><span class="p">)</span>
            <span class="n">pbest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbest</span><span class="p">)</span>
            <span class="n">pbest_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbest_value</span><span class="p">)</span>
            <span class="n">gbest_cost_history</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">gbest_cost_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">gbest_cost_history</span><span class="p">],</span> <span class="p">[</span><span class="n">gbest_cost</span><span class="p">])</span>
            <span class="n">rt_st_os_analysis</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__analyseSignal</span><span class="p">(</span><span class="n">gbest</span><span class="p">,</span> <span class="n">curr_iter</span><span class="p">)]</span>
            <span class="n">iter_gbest_reached</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_gbest_reached</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">=</span> <span class="n">meta_path_to_pso_data</span> 
            <span class="n">curr_iter</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">curr_rep</span> <span class="o">+=</span> <span class="mi">1</span> 
            

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;################### FINISHED PSO ALGORITHM ##################&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__getPsoPerformance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                            <span class="n">gbest</span><span class="p">,</span> 
                            <span class="n">iter_gbest_reached</span><span class="p">,</span> 
                            <span class="n">gbest_cost_history</span><span class="p">,</span> 
                            <span class="n">rt_st_os_analysis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method analyses, plots and saves the pso algorithm&#39;s performance</span>

<span class="sd">        Args:</span>
<span class="sd">        - gbest = best global particle position</span>
<span class="sd">        - iter_gbest_reached = array of iterations at which a new gbest was found</span>
<span class="sd">        - gbest_cost_history = array of the history of gbest values that were found</span>

<span class="sd">        Returns:</span>
<span class="sd">        - </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gbest</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gbest</span><span class="p">]</span>

        <span class="c1"># get best particle position output signal</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gbest_PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getTransferFunctionOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim_model</span><span class="p">,</span> 
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">gbest</span><span class="p">,</span> 
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> 
                                                             <span class="bp">self</span><span class="o">.</span><span class="n">X0</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gbest_PV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getSoaOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest</span><span class="p">)</span> 
    
        <span class="c1"># plot final output signal</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SP</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Target SP&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_PV</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Initial Output&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbest_PV</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PSO-Optimised Output&#39;</span><span class="p">)</span>
        <span class="n">st_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">rt_st_os_analysis</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">rt_st_os_analysis</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> 
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[</span><span class="n">st_index</span><span class="p">],</span> 
                 <span class="bp">self</span><span class="o">.</span><span class="n">gbest_PV</span><span class="p">[</span><span class="n">st_index</span><span class="p">],</span> 
                 <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> 
                 <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Settling Point&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Final PSO-Optimised Output Signal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;final_output.png&#39;</span><span class="p">)</span>  
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># plot final driving signal</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Initial Input&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbest</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PSO-Optimised Input&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Final PSO-Optimised Input Signal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;final_input.png&#39;</span><span class="p">)</span>  
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># plot learning curve</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iter_gbest_reached</span><span class="p">,</span> <span class="n">gbest_cost_history</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PSO Algorithm MSE Learning Curve&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;No. Iterations&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cost &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cost_f</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;final_learning_curve.png&#39;</span><span class="p">)</span>  
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># plot how rt, st and os varied with iterations</span>
        <span class="n">max_rt</span><span class="p">,</span> <span class="n">max_st</span><span class="p">,</span> <span class="n">max_os</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">rt_st_os_analysis</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span>\
                                 <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">rt_st_os_analysis</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span>\
                                 <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">rt_st_os_analysis</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span> 
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iter_gbest_reached</span><span class="p">,</span> 
                 <span class="n">rt_st_os_analysis</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">max_rt</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rise Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iter_gbest_reached</span><span class="p">,</span> 
                 <span class="n">rt_st_os_analysis</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">max_st</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Settling Time&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">iter_gbest_reached</span><span class="p">,</span> 
                 <span class="n">rt_st_os_analysis</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">max_os</span><span class="p">,</span> 
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Overshoot&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PSO Algorithm RT-ST-OS Learning Curve&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;No. Iterations&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Normalised RT/ST/OS&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s1">&#39;rtstos_learning_curve.png&#39;</span><span class="p">)</span>  
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


        <span class="c1"># save key data</span>
        <span class="n">t_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">)</span> 
        <span class="n">init_OP_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_OP</span><span class="p">)</span> <span class="c1">#</span>
        <span class="n">OP_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest</span><span class="p">)</span> 
        <span class="n">SP_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SP</span><span class="p">)</span> 
        <span class="n">init_PV_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_PV</span><span class="p">)</span> 
        <span class="n">PV_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbest_PV</span><span class="p">)</span> 
        <span class="n">iter_gbest_reached_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">iter_gbest_reached</span><span class="p">)</span> 
        <span class="n">gbest_cost_history_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gbest_cost_history</span><span class="p">)</span> 
        <span class="n">rt_st_os_analysis_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rt_st_os_analysis</span><span class="p">)</span> 

        <span class="n">t_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;time.csv&quot;</span><span class="p">,</span> 
                    <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                    <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">init_OP_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;initial_OP.csv&quot;</span><span class="p">,</span> 
                          <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                          <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">OP_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;optimised_OP.csv&quot;</span><span class="p">,</span> 
                     <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">SP_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;SP.csv&quot;</span><span class="p">,</span> 
                     <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">init_PV_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;initial_PV.csv&quot;</span><span class="p">,</span> 
                          <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                          <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">PV_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;optimised_PV.csv&quot;</span><span class="p">,</span> 
                     <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">iter_gbest_reached_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;iter_gbest_reached.csv&quot;</span><span class="p">,</span> 
                                     <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">gbest_cost_history_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;gbest_cost_history.csv&quot;</span><span class="p">,</span> 
                                     <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                     <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">rt_st_os_analysis_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path_to_pso_data</span> <span class="o">+</span> <span class="s2">&quot;rt_st_os_analysis.csv&quot;</span><span class="p">,</span> 
                                    <span class="n">index</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                    <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

        

<div class="viewcode-block" id="run_test"><a class="viewcode-back" href="../../soa.html#soa.optimisation.run_test">[docs]</a><span class="k">def</span> <span class="nf">run_test</span><span class="p">(</span><span class="n">directory_for_run</span><span class="p">,</span> 
             <span class="n">tf_for_run</span><span class="p">,</span> 
             <span class="n">t</span><span class="p">,</span> 
             <span class="n">init_OP</span><span class="p">,</span> 
             <span class="n">n</span><span class="p">,</span> 
             <span class="n">iter_max</span><span class="p">,</span> 
             <span class="n">rep_max</span><span class="p">,</span> 
             <span class="n">init_v_f</span><span class="p">,</span> 
             <span class="n">max_v_f</span><span class="p">,</span> 
             <span class="n">w_init</span><span class="p">,</span> 
             <span class="n">w_final</span><span class="p">,</span> 
             <span class="n">adapt_accel</span><span class="p">,</span> 
             <span class="n">areas_to_suppress</span><span class="p">,</span> 
             <span class="n">on_suppress_f</span><span class="p">,</span> 
             <span class="n">embed_init_signal</span><span class="p">,</span> 
             <span class="n">path_to_embedded_signal</span><span class="p">,</span> 
             <span class="n">cost_f</span><span class="p">,</span> 
             <span class="n">st_importance_factor</span><span class="p">,</span> 
             <span class="n">record_extra_info</span><span class="p">,</span> 
             <span class="n">linux</span><span class="p">,</span>
             <span class="n">sp</span><span class="p">,</span> 
             <span class="n">pso_objs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function defines the test we want to run for each job in a list of</span>
<span class="sd">    python multiprocessing jobs. It is not essential to use this function</span>
<span class="sd">    to run a loop of different PSO runs, but this will execute the PSO runs in</span>
<span class="sd">    parallel and therefore significantly speed up your experiments.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">psoObject</span> <span class="o">=</span> <span class="n">PSO</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> 
                    <span class="n">init_OP</span><span class="p">,</span> 
                    <span class="n">n</span><span class="p">,</span> 
                    <span class="n">iter_max</span><span class="p">,</span> 
                    <span class="n">rep_max</span><span class="p">,</span> 
                    <span class="n">init_v_f</span><span class="p">,</span> 
                    <span class="n">max_v_f</span><span class="p">,</span> 
                    <span class="n">w_init</span><span class="o">=</span><span class="n">w_init</span><span class="p">,</span> 
                    <span class="n">w_final</span><span class="o">=</span><span class="n">w_final</span><span class="p">,</span> 
                    <span class="n">adapt_accel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                    <span class="n">areas_to_suppress</span><span class="o">=</span><span class="s1">&#39;pisic_shape&#39;</span><span class="p">,</span> 
                    <span class="n">on_suppress_f</span><span class="o">=</span><span class="n">on_suppress_f</span><span class="p">,</span> 
                    <span class="n">embed_init_signal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                    <span class="n">path_to_embedded_signal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                    <span class="n">directory</span><span class="o">=</span><span class="n">directory_for_run</span><span class="p">,</span> 
                    <span class="n">cost_f</span><span class="o">=</span><span class="n">cost_f</span><span class="p">,</span> 
                    <span class="n">st_importance_factor</span><span class="o">=</span><span class="n">st_importance_factor</span><span class="p">,</span> 
                    <span class="n">sim_model</span><span class="o">=</span><span class="n">tf_for_run</span><span class="p">,</span> 
                    <span class="n">record_extra_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                    <span class="n">SP</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
    
    <span class="n">pso_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">psoObject</span><span class="p">)</span></div>

































<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Below is an example implementation of the above PSO code. Note that there </span>
<span class="sd">    are 2 main modes of using this PSO implementation:</span>

<span class="sd">    1) Simulation (using a transfer function that simulates SOAs)</span>
<span class="sd">    2) Experimental </span>

<span class="sd">    To use the experimental setup, you will need all the same equipment, modules,</span>
<span class="sd">    specific GPIB addresses etc. that were used in the Connet lab in UCL&#39;s</span>
<span class="sd">    EEE Robert&#39;s building (contact the Optical Networks Group for more info).</span>
<span class="sd">    Users outside of ONG will need to write code to interface with their</span>
<span class="sd">    own equipment.</span>

<span class="sd">    To use the simulation (i.e. the transfer function), the user should not need</span>
<span class="sd">    to write any code themselves. Simply changing the below &#39;directory&#39; variable</span>
<span class="sd">    to point this programme to where to store data should be sufficient. </span>

<span class="sd">    The below code runs a PSO simulation, where PSO is optimising 10 different</span>
<span class="sd">    SOA transfer functions in parallel. Users can play around with the PSO</span>
<span class="sd">    hyperparameters to control PSO performance, convergence properties, </span>
<span class="sd">    run time etc., and can also distort the transfer function by adjusting </span>
<span class="sd">    the distortion coefficients or even implement their own transfer functions</span>
<span class="sd">    to simulate their custom SOAs. By optimising different transfer functions,</span>
<span class="sd">    users will be able to see how well PSO is generalising to different SOAs.</span>

<span class="sd">    While this code is not the &#39;cleanest&#39;, we have tried to insert clear comments</span>
<span class="sd">    so that a user wishing to delve deeper into the use of this PSO implementation </span>
<span class="sd">    (beyond running simple transfer function simulations) can follow the logic </span>
<span class="sd">    and implement the same functionality in their own programmes. </span>

<span class="sd">    As a general rule-of-thumb, increasing n (the number of particles) is a </span>
<span class="sd">    reliable way to improve PSO performance and find more optimal solutions.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">import</span> <span class="nn">soa</span>



    <span class="c1"># set dir to save data</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">soa</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/../data/&#39;</span>

    <span class="c1"># specify whether running simulation or experiment</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># specify if using linux (or mac) (for backslash or forward slash dirs)</span>
    <span class="n">linux</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">num_points</span> <span class="o">=</span> <span class="mi">240</span>
    <span class="n">time_start</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">time_stop</span> <span class="o">=</span> <span class="mf">20e-9</span> 
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">time_start</span><span class="p">,</span><span class="n">time_stop</span><span class="p">,</span><span class="n">num_points</span><span class="p">)</span>
    <span class="n">init_OP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_points</span><span class="p">)</span>

    <span class="c1"># config pso params</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span> 
    <span class="n">iter_max</span> <span class="o">=</span> <span class="mi">150</span>
    <span class="n">rep_max</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">max_v_f</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">init_v_f</span> <span class="o">=</span> <span class="n">max_v_f</span>
    <span class="n">cost_f</span> <span class="o">=</span> <span class="s1">&#39;mSE&#39;</span>
    <span class="n">st_importance_factor</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">w_init</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">w_final</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">on_suppress_f</span> <span class="o">=</span> <span class="mf">2.0</span>

    <span class="k">if</span> <span class="n">sim</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># define transfer function(s)</span>
        <span class="c1"># N.B. init_OP low must be -1 for tf</span>
        <span class="n">init_OP</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">num_points</span><span class="p">)],</span><span class="n">init_OP</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">num_points</span><span class="p">):]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span>
        <span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.01199757841099e85</span><span class="p">]</span>
        <span class="n">den</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">1.64898505756825e0</span><span class="p">,</span>
            <span class="mf">4.56217233166632e10</span><span class="p">,</span>
            <span class="mf">3.04864287973918e21</span><span class="p">,</span>
            <span class="mf">4.76302109455371e31</span><span class="p">,</span>
            <span class="mf">1.70110870487715e42</span><span class="p">,</span>
            <span class="mf">1.36694076792557e52</span><span class="p">,</span>
            <span class="mf">2.81558045148153e62</span><span class="p">,</span>
            <span class="mf">9.16930673102975e71</span><span class="p">,</span>
            <span class="mf">1.68628748250276e81</span><span class="p">,</span>
            <span class="mf">2.40236028415562e90</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">TransferFunction</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>

        <span class="c1"># set up simulation(s) you want to run</span>
        <span class="n">init_PV</span> <span class="o">=</span> <span class="n">distort_tf</span><span class="o">.</span><span class="n">getTransferFunctionOutput</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span><span class="n">init_OP</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">analyse</span><span class="o">.</span><span class="n">ResponseMeasurements</span><span class="p">(</span><span class="n">init_PV</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">sp</span>
        <span class="n">tfs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">distort_tf</span><span class="o">.</span><span class="n">gen_tfs</span><span class="p">(</span><span class="n">num_facs</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.4</span><span class="p">],</span> 
                                    <span class="n">a0_facs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">],</span>
                                    <span class="n">a1_facs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],</span>
                                    <span class="n">a2_facs</span><span class="o">=</span><span class="p">[</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">],</span>
                                    <span class="n">all_combos</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">pso_objs</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Manager</span><span class="p">()</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">test_nums</span> <span class="o">=</span> <span class="p">[</span><span class="n">test</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tfs</span><span class="p">))]</span>
        <span class="n">direcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">directory</span> <span class="o">+</span> <span class="s1">&#39;/test_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_num</span><span class="p">)</span> <span class="k">for</span> <span class="n">test_num</span> <span class="ow">in</span> <span class="n">test_nums</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">tf</span><span class="p">,</span> <span class="n">direc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tfs</span><span class="p">,</span> <span class="n">direcs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">direc</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">direc</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">run_test</span><span class="p">,</span> 
                                        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">direc</span><span class="p">,</span> 
                                              <span class="n">tf</span><span class="p">,</span> 
                                              <span class="n">t</span><span class="p">,</span> 
                                              <span class="n">init_OP</span><span class="p">,</span> 
                                              <span class="n">n</span><span class="p">,</span> 
                                              <span class="n">iter_max</span><span class="p">,</span> 
                                              <span class="n">rep_max</span><span class="p">,</span> 
                                              <span class="n">init_v_f</span><span class="p">,</span> 
                                              <span class="n">max_v_f</span><span class="p">,</span> 
                                              <span class="n">w_init</span><span class="p">,</span> 
                                              <span class="n">w_final</span><span class="p">,</span> 
                                              <span class="kc">True</span><span class="p">,</span> 
                                              <span class="s1">&#39;pisic_shape&#39;</span><span class="p">,</span> 
                                              <span class="n">on_suppress_f</span><span class="p">,</span> 
                                              <span class="kc">True</span><span class="p">,</span> 
                                              <span class="kc">None</span><span class="p">,</span> 
                                              <span class="n">cost_f</span><span class="p">,</span> 
                                              <span class="n">st_importance_factor</span><span class="p">,</span> 
                                              <span class="kc">True</span><span class="p">,</span> 
                                              <span class="n">linux</span><span class="p">,</span>
                                              <span class="n">sp</span><span class="p">,</span> 
                                              <span class="n">pso_objs</span><span class="p">,))</span>
            
            <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="n">job</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="c1"># plot composite graph</span>
        <span class="n">pso_objs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pso_objs</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pso_obj</span> <span class="ow">in</span> <span class="n">pso_objs</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pso_obj</span><span class="o">.</span><span class="n">gbest_PV</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


        <span class="c1"># pickle data</span>
        <span class="n">PIK</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s1">&#39;/pickle.dat&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pso_objs</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">PIK</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>





    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># set up experiment(s) you want to run</span>
        <span class="n">directory</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\onglab\Desktop\SOA_project\Chris\pso_no_fall_test_09012020&quot;</span> 
        <span class="n">awg</span> <span class="o">=</span> <span class="n">devices</span><span class="o">.</span><span class="n">TektronixAWG7122B</span><span class="p">(</span><span class="s2">&quot;GPIB1::1::INSTR&quot;</span><span class="p">)</span>
        <span class="n">osc</span> <span class="o">=</span> <span class="n">devices</span><span class="o">.</span><span class="n">Agilent86100C</span><span class="p">(</span><span class="s2">&quot;GPIB1::7::INSTR&quot;</span><span class="p">)</span>
        <span class="n">osc</span><span class="o">.</span><span class="n">set_acquire</span><span class="p">(</span><span class="n">average</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">num_points</span><span class="p">)</span>
        <span class="n">osc</span><span class="o">.</span><span class="n">set_timebase</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="mf">4.2e-8</span><span class="p">,</span> <span class="n">range_</span><span class="o">=</span><span class="n">time_stop</span><span class="o">-</span><span class="n">time_start</span><span class="p">)</span>

        <span class="n">init_OP</span><span class="p">[:</span><span class="mi">60</span><span class="p">],</span> <span class="n">init_OP</span><span class="p">[</span><span class="mi">60</span><span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span> 

        <span class="n">psoObject</span> <span class="o">=</span> <span class="n">pso</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> 
                        <span class="n">init_OP</span><span class="p">,</span> 
                        <span class="n">n</span><span class="p">,</span> 
                        <span class="n">iter_max</span><span class="p">,</span> 
                        <span class="n">rep_max</span><span class="p">,</span> 
                        <span class="n">init_v_f</span><span class="p">,</span> 
                        <span class="n">max_v_f</span><span class="p">,</span> 
                        <span class="n">w_init</span><span class="o">=</span><span class="n">w_init</span><span class="p">,</span> 
                        <span class="n">w_final</span><span class="o">=</span><span class="n">w_final</span><span class="p">,</span> 
                        <span class="n">adapt_accel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">areas_to_suppress</span><span class="o">=</span><span class="s1">&#39;start_centre&#39;</span><span class="p">,</span> 
                        <span class="n">on_suppress_f</span><span class="o">=</span><span class="n">on_suppress_f</span><span class="p">,</span> 
                        <span class="n">embed_init_signal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">path_to_embedded_signal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                        <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span> 
                        <span class="n">cost_f</span><span class="o">=</span><span class="n">cost_f</span><span class="p">,</span> 
                        <span class="n">st_importance_factor</span><span class="o">=</span><span class="n">st_importance_factor</span><span class="p">,</span> 
                        <span class="n">awg</span><span class="o">=</span><span class="n">awg</span><span class="p">,</span> 
                        <span class="n">osc</span><span class="o">=</span><span class="n">osc</span><span class="p">)</span> 
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Christopher W. F. Parsonson

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>